<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>File Link Extractor</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Oxygen, Ubuntu, Cantarell, 'Open Sans', 'Helvetica Neue', sans-serif;
            background-color: #f9fafb;
        }
        .container {
            max-width: 800px;
            margin: 0 auto;
            padding: 20px;
        }
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div class="container max-w-4xl mx-auto p-4 bg-gray-50 min-h-screen">
        <div class="mb-8 text-center">
            <h1 class="text-3xl font-bold text-blue-600 mb-2">File Link Extractor</h1>
            <p class="text-gray-600">Enter a Terabox or compatible URL to extract file information</p>
            <div class="mt-2 text-sm text-gray-500">
                Supported domains: teraboxapp.com, terabox.com, 1024tera.com, terabox.app, teraboxpro.com, 
                nephobox.com, 4funbox.com, dubox.com, terafileshare.com and more
            </div>
        </div>

        <form id="urlForm" class="mb-8">
            <div class="flex flex-col md:flex-row gap-2">
                <input
                    type="text"
                    id="urlInput"
                    placeholder="Enter URL (e.g., https://teraboxapp.com/s/... or any supported domain)"
                    class="flex-grow p-3 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500"
                    required
                />
                <button
                    type="submit"
                    id="submitButton"
                    class="bg-blue-600 text-white py-3 px-6 rounded-md font-medium hover:bg-blue-700 focus:outline-none focus:ring-2 focus:ring-blue-500 focus:ring-offset-2"
                >
                    Extract Info
                </button>
            </div>
        </form>

        <div id="errorContainer" class="bg-red-100 border-l-4 border-red-500 text-red-700 p-4 mb-4 rounded-md hidden">
            <p id="errorMessage"></p>
            <button 
                id="debugButton"
                class="text-blue-600 text-sm mt-2 underline"
            >
                Show Debug Info
            </button>
            
            <div id="debugInfo" class="mt-3 p-3 bg-gray-800 text-white rounded text-xs overflow-x-auto hidden">
                <p id="apiUrlText">API URL: </p>
                <p class="mt-2">Try opening this URL directly in your browser to test the API.</p>
                <p id="extractedUrlText" class="mt-2">Extracted URL: </p>
            </div>
        </div>

        <div id="loadingIndicator" class="text-center py-4 hidden">
            <div class="inline-block animate-spin rounded-full h-8 w-8 border-b-2 border-blue-600"></div>
            <p class="mt-2 text-gray-600">Processing your request...</p>
        </div>

        <div id="fileInfoContainer" class="bg-white p-6 rounded-md shadow-md hidden">
            <h2 class="text-xl font-semibold mb-4 text-gray-800">File Information</h2>
            
            <div class="space-y-4">
                <div class="border-b pb-3">
                    <h3 class="text-sm font-medium text-gray-500">Filename</h3>
                    <p id="filename" class="mt-1 text-lg">Unknown</p>
                </div>
                
                <div class="border-b pb-3">
                    <h3 class="text-sm font-medium text-gray-500">File Size</h3>
                    <p id="filesize" class="mt-1 text-lg">Unknown</p>
                </div>
                
                <div class="border-b pb-3">
                    <h3 class="text-sm font-medium text-gray-500">Category</h3>
                    <p id="category" class="mt-1 text-lg">Unknown</p>
                </div>
                
                <div class="border-b pb-3">
                    <h3 class="text-sm font-medium text-gray-500">Created On</h3>
                    <p id="createTime" class="mt-1 text-lg">Unknown</p>
                </div>
                
                <div class="border-b pb-3">
                    <h3 class="text-sm font-medium text-gray-500">Developer</h3>
                    <p id="dev" class="mt-1 text-lg">Unknown</p>
                </div>
                
                <div class="border-b pb-3">
                    <h3 class="text-sm font-medium text-gray-500">Created By</h3>
                    <p id="createdBy" class="mt-1 text-lg">Unknown</p>
                </div>
                
                <div class="border-b pb-3">
                    <h3 class="text-sm font-medium text-gray-500">Telegram Channel</h3>
                    <p id="telegramChannel" class="mt-1 text-lg">Unknown</p>
                </div>
                
                <div>
                    <h3 class="text-sm font-medium text-gray-500">Download Link</h3>
                    <div id="downloadLinkContainer" class="mt-2">
                        <a
                            id="downloadButton"
                            href="#"
                            target="_blank"
                            rel="noopener noreferrer"
                            class="inline-block bg-green-600 text-white py-2 px-4 rounded-md font-medium hover:bg-green-700"
                        >
                            Download File
                        </a>
                        <div id="downloadLinkText" class="mt-3 p-2 bg-gray-100 rounded-md text-sm text-gray-800 break-all">
                        </div>
                    </div>
                    <p id="noLinkMessage" class="mt-1 text-red-600 hidden">No download link available</p>
                </div>
            </div>
        </div>
        
        <!-- Test Data Button (for development) -->
        <div class="mt-6 text-center">
            <button 
                id="testDataButton" 
                class="text-sm text-gray-500 underline"
            >
                Load Test Data
            </button>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const urlForm = document.getElementById('urlForm');
            const urlInput = document.getElementById('urlInput');
            const submitButton = document.getElementById('submitButton');
            const errorContainer = document.getElementById('errorContainer');
            const errorMessage = document.getElementById('errorMessage');
            const debugButton = document.getElementById('debugButton');
            const debugInfo = document.getElementById('debugInfo');
            const apiUrlText = document.getElementById('apiUrlText');
            const extractedUrlText = document.getElementById('extractedUrlText');
            const loadingIndicator = document.getElementById('loadingIndicator');
            const fileInfoContainer = document.getElementById('fileInfoContainer');
            const filename = document.getElementById('filename');
            const filesize = document.getElementById('filesize');
            const category = document.getElementById('category');
            const createTime = document.getElementById('createTime');
            const dev = document.getElementById('dev');
            const createdBy = document.getElementById('createdBy');
            const telegramChannel = document.getElementById('telegramChannel');
            const downloadLinkContainer = document.getElementById('downloadLinkContainer');
            const downloadButton = document.getElementById('downloadButton');
            const downloadLinkText = document.getElementById('downloadLinkText');
            const noLinkMessage = document.getElementById('noLinkMessage');
            const testDataButton = document.getElementById('testDataButton');

            let debugMode = false;
            
            // Sample test data
            const testData = {
                "ok": true,
                "message": "‚úÖ Your file has been successfully retrieved!",
                "filename": "üìÇ 5_6329906926645675697(2)(2)(2).mp4",
                "size": "üìè 4.19 MB",
                "category": "üìå 1",
                "create_time": "‚è≥ 2022-11-21T11:41:35.000Z",
                "downloadLink": "üîó https://d-jp02-zen.terabox.com/file/0bfa099a4cb572b3ec316f221b5789cb?bkt=en-82d2bca2fdceac3feb25f206740326aa1e818b98e6b2b1babfbb08220f9238c47c9cac8e0a7ca705&xcode=a1a716af2d4dbbe994530180d9d37f0088ad701f5967be7095bf41bba0041b2d3b3f4a1a0d16bad10fca93440000a4aaaa68de184fb12011&fid=4401934006824-250528-234086870370988&time=1743251311&sign=FDTAXUGERLQlBHSKfWon-DCb740ccc5511e5e8fedcff06b081203-kCV3oN0p%2BOWUaPFgm5NlerKUHI4%3D&to=149&size=4392762&sta_dx=4392762&sta_cs=4&sta_ft=mp4&sta_ct=7&sta_mt=5&fm2=MH%2Ctky%2CAnywhere%2C%2C%2Cany&region=tky&ctime=1669030895&mtime=1731563187&resv0=-1&resv1=0&resv2=rlim&resv3=5&resv4=4392762&vuk=4401514344005&iv=0&htype=&randtype=&newver=1&newfm=1&secfm=1&flow_ver=3&pkey=en-972444be7837798486b86325ede217a53ab3e8bb091f801d080c171ff67649c62e604fbeebef5e9d&sl=68091977&expires=1743280111&rt=sh&r=606813729&sh=1&vbdid=-&fin=5_6329906926645675697%282%29%282%29%282%29.mp4&rtype=1&dp-logid=8955091340874991846&dp-callid=0.1&hps=1&tsl=2000&csl=2000&fsl=-1&csign=%2Fg7F1AmTtnWd27Rco4go6dDvbdg%3D&so=0&ut=6&uter=0&serv=1&uc=0&ti=14a3010384c1ca3cd0a29c27c94823964250f09f16bb4430305a5e1275657320&tuse=&raw_appid=0&ogr=0&rregion=XVVi&adg=&reqlabel=250528_f_74d3bd57ea002b4817a6e5b1a6af322a_-1_4517a319922acc893604848f6a741e71&ccn=SG&by=themis",
                "Dev": "‚ù£Ô∏è Farooq_is_king.t.me",
                "Created_by": "üõ† ùêñùêéùêéùêÉùêúùê´ùêöùêüùê≠",
                "Telegram_Channel": "üì¢ Opleech_WD.t.me"
            };

            // Function to extract URL
            function extractTeraboxUrl(inputUrl) {
                const domainPatterns = [
                    'teraboxapp\\.com',
                    'terabox\\.com',
                    '1024tera\\.com',
                    'terabox\\.app',
                    'teraboxpro\\.com',
                    'teraboxpro\\.app',
                    'nephobox\\.com',
                    'nephocloud\\.com',
                    '4funbox\\.com',
                    'teraboxapp\\.cc',
                    'dubox\\.com',
                    'botsapp\\.me',
                    'boteapp\\.me',
                    'ufile\\.io',
                    'mirrorcreator\\.com',
                    'mirrorace\\.com',
                    'mirrorace\\.org',
                    'terafileshare\\.com'
                ];
                
                const regex = new RegExp(`(https?:\\/\\/(?:www\\.)?(?:${domainPatterns.join('|')})\\/s\\/[a-zA-Z0-9_\\-\\.]+)`, 'i');
                const match = inputUrl.match(regex);
                return match ? match[1] : inputUrl;
            }

            // Function to format file size (if not already formatted)
            function formatFileSize(sizeStr) {
                if (!sizeStr) return 'Unknown';
                
                // If size is already a formatted string (starts with an emoji or contains units)
                if (typeof sizeStr === 'string' && (sizeStr.trim().startsWith('üìè') || 
                    sizeStr.includes(' KB') || sizeStr.includes(' MB') || sizeStr.includes(' GB'))) {
                    return sizeStr;
                }
                
                // Otherwise parse as number and format
                const bytes = parseFloat(sizeStr);
                if (isNaN(bytes)) return sizeStr || 'Unknown';
                
                const units = ['B', 'KB', 'MB', 'GB', 'TB'];
                let size = bytes;
                let unitIndex = 0;
                
                while (size >= 1024 && unitIndex < units.length - 1) {
                    size /= 1024;
                    unitIndex++;
                }
                
                return `${size.toFixed(2)} ${units[unitIndex]}`;
            }

            // Function to format date
            function formatDate(dateStr) {
                if (!dateStr) return 'Unknown';
                
                // Remove emoji if present
                if (dateStr.startsWith('‚è≥')) {
                    dateStr = dateStr.substring(dateStr.indexOf(' ') + 1);
                }
                
                try {
                    const date = new Date(dateStr);
                    return date.toLocaleString();
                } catch (e) {
                    return dateStr;
                }
            }

            // Toggle debug info
            debugButton.addEventListener('click', function() {
                debugMode = !debugMode;
                debugInfo.classList.toggle('hidden');
                debugButton.textContent = debugMode ? 'Hide Debug Info' : 'Show Debug Info';
            });

            // Test data button
            testDataButton.addEventListener('click', function() {
                hideError();
                showFileInfo(testData);
            });

            // Handle form submission
            urlForm.addEventListener('submit', async function(e) {
                e.preventDefault();
                
                const url = urlInput.value.trim();
                
                if (!url) {
                    showError('Please enter a valid URL');
                    return;
                }
                
                setLoading(true);
                hideError();
                hideFileInfo();
                
                try {
                    // Extract the URL from any wrapper
                    const extractedUrl = extractTeraboxUrl(url);
                    console.log("Extracted URL:", extractedUrl);
                    
                    // Create API URL with direct parameter addition instead of encoding
                    const apiUrl = `https://terabox-test-api.wd-zone.workers.dev/?url=${extractedUrl}`;
                    
                    // Update debug info
                    apiUrlText.textContent = `API URL: ${apiUrl}`;
                    extractedUrlText.textContent = `Extracted URL: ${extractedUrl}`;
                    
                    // Basic validation for URL format
                    if (extractedUrl === url && !url.match(/https?:\/\/(www\.)?[a-zA-Z0-9-]+\.[a-zA-Z0-9-.]+\/s\//i)) {
                        throw new Error('The URL format is not recognized. Please enter a supported sharing URL.');
                    }
                    
                    console.log("API URL:", apiUrl);
                    
                    // Implement a timeout for the fetch request
                    const controller = new AbortController();
                    const timeoutId = setTimeout(() => controller.abort(), 30000); // 30-second timeout
                    
                    try {
                        // Make the API request
                        const response = await fetch(apiUrl, {
                            signal: controller.signal,
                            method: 'GET',
                            headers: {
                                'Accept': 'application/json'
                            }
                        });
                        
                        clearTimeout(timeoutId);
                        
                        console.log("Response status:", response.status);
                        
                        if (!response.ok) {
                            throw new Error(`Server error: ${response.status} - ${response.statusText}`);
                        }
                        
                        // Parse the response
                        const data = await response.json();
                        console.log("API response:", data);
                        
                        // Handle API error responses
                        if (data.error) {
                            throw new Error(`API error: ${data.error}`);
                        }
                        
                        // Validate the response data
                        if (!data || typeof data !== 'object') {
                            throw new Error('Invalid response format from API');
                        }
                        
                        if (!data.filename && !data.size && !data.downloadLink) {
                            throw new Error('No file information could be extracted from this URL. The API may be down or the URL may not be supported.');
                        }
                        
                        // Display the file info
                        showFileInfo(data);
                    } catch (fetchError) {
                        if (fetchError.name === 'AbortError') {
                            throw new Error('Request timed out. The API service may be unavailable.');
                        } else {
                            throw fetchError;
                        }
                    }
                } catch (err) {
                    console.error("Error:", err);
                    showError(err.message || 'Failed to extract file information');
                } finally {
                    setLoading(false);
                }
            });

            // Show error message
            function showError(message) {
                errorMessage.textContent = message;
                errorContainer.classList.remove('hidden');
            }

            // Hide error message
            function hideError() {
                errorContainer.classList.add('hidden');
            }

            // Set loading state
            function setLoading(isLoading) {
                if (isLoading) {
                    submitButton.textContent = 'Processing...';
                    submitButton.disabled = true;
                    loadingIndicator.classList.remove('hidden');
                } else {
                    submitButton.textContent = 'Extract Info';
                    submitButton.disabled = false;
                    loadingIndicator.classList.add('hidden');
                }
            }

            // Show file information
            function showFileInfo(data) {
                // Set all the fields with data
                filename.textContent = data.filename || 'Unknown';
                filesize.textContent = data.size || formatFileSize(data.size);
                category.textContent = data.category || 'Unknown';
                createTime.textContent = formatDate(data.create_time);
                dev.textContent = data.Dev || 'Unknown';
                createdBy.textContent = data.Created_by || 'Unknown';
                telegramChannel.textContent = data.Telegram_Channel || 'Unknown';
                
                if (data.downloadLink) {
                    // Remove the emoji prefix if present
                    let cleanLink = data.downloadLink;
                    if (cleanLink.startsWith('üîó')) {
                        cleanLink = cleanLink.substring(cleanLink.indexOf(' ') + 1);
                    }
                    
                    downloadButton.href = cleanLink;
                    downloadLinkText.textContent = cleanLink;
                    downloadLinkContainer.classList.remove('hidden');
                    noLinkMessage.classList.add('hidden');
                } else {
                    downloadLinkContainer.classList.add('hidden');
                    noLinkMessage.classList.remove('hidden');
                }
                
                fileInfoContainer.classList.remove('hidden');
            }

            // Hide file information
            function hideFileInfo() {
                fileInfoContainer.classList.add('hidden');
            }
        });
    </script>
</body>
</html>
